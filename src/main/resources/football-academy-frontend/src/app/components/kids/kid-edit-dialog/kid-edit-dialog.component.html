<h2 mat-dialog-title>Edit Kid</h2>
    <mat-dialog-content>
      <form [formGroup]="editKidForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <select
              class="form-control"
              formControlName="parentId"
              [ngClass]="{'is-invalid': editKidForm.get('parentId')?.touched && editKidForm.get('parentId')?.invalid}"
            >
              <option value="">Select Parent</option>
              <option *ngFor="let parent of parents" [value]="parent.userId">
                {{ parent.firstName }} {{ parent.lastName }} ({{ parent.email }})
              </option>
            </select>
            <div class="invalid-feedback">Parent is required</div>
          </div>
          <div class="col-md-6 mb-3">
            <input
              type="text"
              class="form-control"
              placeholder="First Name"
              formControlName="firstName"
              [ngClass]="{'is-invalid': editKidForm.get('firstName')?.touched && editKidForm.get('firstName')?.invalid}"
            >
            <div class="invalid-feedback">First Name is required</div>
          </div>
          <div class="col-md-6 mb-3">
            <input
              type="text"
              class="form-control"
              placeholder="Last Name"
              formControlName="lastName"
              [ngClass]="{'is-invalid': editKidForm.get('lastName')?.touched && editKidForm.get('lastName')?.invalid}"
            >
            <div class="invalid-feedback">Last Name is required</div>
          </div>
          <div class="col-md-6 mb-3">
            <input
              type="date"
              class="form-control"
              formControlName="dateOfBirth"
              [ngClass]="{'is-invalid': editKidForm.get('dateOfBirth')?.touched && editKidForm.get('dateOfBirth')?.invalid}"
            >
            <div class="invalid-feedback">Date of Birth is required</div>
          </div>
          <div class="col-md-6 mb-3">
            <input
              type="date"
              class="form-control"
              formControlName="enrollmentDate"
              [ngClass]="{'is-invalid': editKidForm.get('enrollmentDate')?.touched && editKidForm.get('enrollmentDate')?.invalid}"
            >
            <div class="invalid-feedback">Enrollment Date is required</div>
          </div>
        </div>

        <div class="mt-3">
          <h4>Fee Details</h4>
          <button type="button" class="btn btn-secondary mb-2" (click)="addFeeDetail()">Add Fee</button>
          <div *ngFor="let feeDetail of feeDetails.controls; let i = index" class="row mb-2" [formGroup]="$any(feeDetail)">
            <div class="col-md-2">
              <select
                class="form-control"
                formControlName="feeScheduleId"
                [ngClass]="{'is-invalid': feeDetail.get('feeScheduleId')?.touched && feeDetail.get('feeScheduleId')?.invalid}"
              >
                <option value="">Select Fee Type</option>
                <option *ngFor="let schedule of data.feeSchedules" [value]="schedule.feeScheduleId">
                  {{ schedule.description }}
                </option>
              </select>
              <div class="invalid-feedback">Fee Type is required</div>
            </div>
            <div class="col-md-2">
              <input
                type="number"
                class="form-control"
                placeholder="Amount"
                formControlName="amount"
                [ngClass]="{'is-invalid': feeDetail.get('amount')?.touched && feeDetail.get('amount')?.invalid}"
              >
              <div class="invalid-feedback">Valid amount is required</div>
            </div>
            <div class="col-md-2">
              <div class="form-check form-check-inline">
                <input
                  type="checkbox"
                  class="form-check-input"
                  [formControlName]="'isOneOff'"
                  (change)="toggleChargeType(i, 'ONE_OFF', $event)"
                  [checked]="feeDetail.get('chargeType')?.value === 'ONE_OFF'"
                >
                <label class="form-check-label">One-Off</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  type="checkbox"
                  class="form-check-input"
                  [formControlName]="'isRecurring'"
                  (change)="toggleChargeType(i, 'RECURRING', $event)"
                  [checked]="feeDetail.get('chargeType')?.value === 'RECURRING'"
                >
                <label class="form-check-label">Recurring</label>
              </div>
              <div class="invalid-feedback" *ngIf="feeDetail.get('chargeType')?.touched && feeDetail.get('chargeType')?.invalid">
                Charge Type is required
              </div>
            </div>
            <div class="col-md-2">
              <select
                class="form-control"
                formControlName="recurrenceInterval"
                [ngClass]="{'is-invalid': feeDetail.get('recurrenceInterval')?.touched && feeDetail.get('recurrenceInterval')?.invalid}"
                [disabled]="feeDetail.get('chargeType')?.value === 'ONE_OFF'"
              >
                <option value="">Select Interval</option>
                <option *ngFor="let interval of recurrenceIntervals" [value]="interval">{{ interval }}</option>
              </select>
              <div class="invalid-feedback">Recurrence Interval is required for recurring fees</div>
            </div>
            <div class="col-md-2">
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  formControlName="prorate"
                  [disabled]="feeDetail.get('chargeType')?.value === 'ONE_OFF'"
                >
                <label class="form-check-label">Prorate First Billing</label>
              </div>
            </div>
            <div class="col-md-2">
              <button type="button" class="btn btn-danger btn-sm" (click)="removeFeeDetail(i)">Remove</button>
            </div>
          </div>
        </div>
      </form>
    </mat-dialog-content>
    <mat-dialog-actions>
      <button class="btn btn-primary" (click)="save()" [disabled]="editKidForm.invalid && editKidForm.touched">Save</button>
      <button class="btn btn-secondary" (click)="close()">Cancel</button>
    </mat-dialog-actions>